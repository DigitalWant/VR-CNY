function Head(e,t,a,i,n,o,c){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=o,this.image=c,this.iSpr=0,this.domEle=".headSwiperType",this.putOn=["ctx1","ctx3"]}function Fringe(e,t,a,i,n,o,c){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=o,this.image=c,this.iSpr=0,this.domEle=".fringeSwiperType",this.putOn=["ctx2","ctx4"]}function Eye(e,t,a,i,n,o,c){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=o,this.image=c,this.iSpr=0,this.domEle=".eyeSwiperType",this.putOn=["ctx1","ctx3"]}function Mouth(e,t,a,i,n,o,c){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=o,this.image=c,this.iSpr=0,this.domEle=".mouthSwiperType",this.putOn=["ctx1","ctx3"]}function Background(e,t,a,i,n,o,c){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=o,this.image=c,this.iSpr=0,this.domEle=".backgroundSwiperType",this.putOn=["ctx3"]}function Body(e,t,a,i,n,o,c){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=o,this.image=c,this.iSpr=0,this.domEle=".skip",this.putOn=["ctx3"]}function Cloth(e,t,a,i,n,o,c){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=o,this.image=c,this.iSpr=0,this.domEle=".clothSwiperType",this.putOn=["ctx3"]}function Bag(e,t,a,i,n,o,c){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=o,this.image=c,this.iSpr=0,this.domEle=".bagSwiperType",this.putOn=["ctx5"]}function Shoes(e,t,a,i,n,o,c){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=o,this.image=c,this.iSpr=0,this.domEle=".shoesSwiperType",this.putOn=["ctx3"]}function sendResultToServer(e){$(".scene .loading").show(),$.post(website_url+"accept_avatar.php",{data:e},function(e){e&&$(".result").fadeOut(1e3,function(){var t='<hr /><div class="container"><h2>Result is:</h2><img src="cache/result'+e+'.jpg" /><button class="button download" onclick="window.open(\'cache/result'+e+'.jpg\');">download result image</button><button class="button" onclick="$(\'.send_email\').toggle();">Send by Email</button><form method="post" action="email.php" class="send_email"><input name="file" value="'+e+'" type="hidden" /><input class="text" name="name" value="" type="text" placeholder="Your Name" /><input class="text" name="email" value="" type="text" placeholder="Your Email" /><input class="button" type="submit" name="submit" /></form></div>';$(this).html(t),$(this).fadeIn(1e3),$(".scene .loading").hide()})})}function checkPortrait(){document.documentElement.clientHeight>document.documentElement.clientWidth?$("body").removeClass("portraitPls"):$("body").addClass("portraitPls")}function clear(){ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),ctx2.clearRect(0,0,ctx2.canvas.width,ctx2.canvas.height),ctx3.clearRect(0,0,ctx3.canvas.width,ctx3.canvas.height),ctx4.clearRect(0,0,ctx4.canvas.width,ctx4.canvas.height),ctx5.clearRect(0,0,ctx5.canvas.width,ctx5.canvas.height)}function drawScene(){clear();for(var e=0;e<faceObject.length;e++)"ctx1"==faceObject[e].putOn[0]&&ctx.drawImage(faceObject[e].image,faceObject[e].x2+faceObject[e].iSpr*faceObject[e].w,faceObject[e].y2,faceObject[e].w,faceObject[e].h,faceObject[e].x+headPosX_onFacebuild,faceObject[e].y+headPosY_onFacebuild,faceObject[e].w*headScaleW_onFacebuild,faceObject[e].h*headScaleW_onFacebuild),"ctx2"==faceObject[e].putOn[0]&&ctx2.drawImage(faceObject[e].image,faceObject[e].x2+faceObject[e].iSpr*faceObject[e].w,faceObject[e].y2,1*faceObject[e].w,1*faceObject[e].h,faceObject[e].x+headPosX_onFacebuild,faceObject[e].y+headPosY_onFacebuild,faceObject[e].w*headScaleW_onFacebuild,faceObject[e].h*headScaleH_onFacebuild);for(var e=0;e<bodyObject.length;e++)ctx4.drawImage(canvas,0,0,faceCanvasWidth,faceCanvasWidth,headPosX_onBodybuild,headPosY_onBodybuild,faceCanvasWidth*headScaleW_onBodybuild,faceCanvasWidth*headScaleH_onBodybuild),ctx4.drawImage(canvas2,0,0,faceCanvasWidth,faceCanvasWidth,headPosX_onBodybuild,headPosY_onBodybuild,faceCanvasWidth*headScaleW_onBodybuild,faceCanvasWidth*headScaleH_onBodybuild),"ctx3"==bodyObject[e].putOn[0]&&ctx3.drawImage(bodyObject[e].image,bodyObject[e].x2+bodyObject[e].iSpr*bodyObject[e].w,bodyObject[e].y2,1*bodyObject[e].w,1*bodyObject[e].h,bodyObject[e].x+bodyPosX_onBodybuild,bodyObject[e].y+bodyPosY_onBodybuild,bodyObject[e].w*bodyScaleW_onBodybuild,bodyObject[e].h*bodyScaleH_onBodybuild),"ctx5"==bodyObject[e].putOn[0]&&ctx5.drawImage(bodyObject[e].image,bodyObject[e].x2+bodyObject[e].iSpr*bodyObject[e].w,bodyObject[e].y2,1*bodyObject[e].w,1*bodyObject[e].h,bodyObject[e].x+bodyPosX_onBodybuild,bodyObject[e].y+bodyPosY_onBodybuild,bodyObject[e].w*bodyScaleW_onBodybuild,bodyObject[e].h*bodyScaleH_onBodybuild)}function exportResult(){var e,t;t=document.createElement("canvas"),e=t.getContext("2d"),t.width=330,t.height=330;var a=ctx4.getImageData(5,5,330,477);a.data;e.putImageData(a,0,0),zdata2=ctx4.getImageData(5,5,330,477),e.putImageData(zdata2,0,0);var i=t.toDataURL("image/jpeg",1);$("#face_result").attr("src",i),sendResultToServer(i)}function wrapText(e,t,a,i,n,o){for(var c=t.split(""),s="",d=0;d<c.length;d++){var p=s+c[d]+"",l=e.measureText(p),r=l.width;r>n&&d>0?(e.fillText(s,a,i),s=c[d]+"",i+=o):s=p}e.fillText(s,a,i)}function assetsPrepare(e,t){"number"==typeof timer&&clearInterval(timer),canvas=document.getElementById("scene"),ctx=canvas.getContext("2d"),canvas2=document.getElementById("scene2"),ctx2=canvas2.getContext("2d"),canvas3=document.getElementById("scene3"),ctx3=canvas3.getContext("2d"),canvas4=document.getElementById("scene4"),ctx4=canvas4.getContext("2d"),canvas5=document.getElementById("scene5"),ctx5=canvas5.getContext("2d");var a=new Image;a.src=website_url+"images/data/"+e+"/eyes.png",a.onload=function(){};var i=new Image;i.src=website_url+"images/data/"+e+"/mouths.png",i.onload=function(){};var n=new Image;n.src=website_url+"images/data/"+e+"/face.png",n.onload=function(){};var o=new Image;o.src=website_url+"images/data/"+e+"/fringes.png",o.onload=function(){};var c=new Image;c.src=website_url+"images/data/"+e+"/background.png",c.onload=function(){};var s=new Image;s.src=website_url+"images/data/"+e+"/body.png",s.onload=function(){};var d=new Image;d.src=website_url+"images/data/"+e+"/cloth.png",d.onload=function(){};var p=new Image;p.src=website_url+"images/data/"+e+"/bag.png",p.onload=function(){};var l=new Image;l.src=website_url+"images/data/"+e+"/shoes.png",l.onload=function(){},faceObject[0]=new Head(0,0,0,0,faceCanvasWidth,faceCanvasHeight,n),faceObject[1]=new Fringe(0,0,0,0,faceCanvasWidth,faceCanvasHeight,o),faceObject[2]=new Eye(0,0,0,0,faceCanvasWidth,faceCanvasHeight,a),faceObject[3]=new Mouth(0,0,0,0,faceCanvasWidth,faceCanvasHeight,i),bodyObject[0]=new Background(0,0,0,0,bodyCanvasWidth,bodyCanvasWidth,c),bodyObject[1]=new Body(0,20,0,0,bodyCanvasWidth,bodyCanvasHeight,s),bodyObject[2]=new Cloth(0,0,0,0,bodyCanvasWidth,bodyCanvasHeight,d),bodyObject[3]=new Bag(0,0,0,0,bodyCanvasWidth,bodyCanvasHeight,p),bodyObject[4]=new Shoes(0,0,0,0,bodyCanvasWidth,bodyCanvasHeight,l),timer=setInterval(drawScene,100)}var bagInfo=[{title:"demo Title 1",content:"bala bala bala...",html:"<div class='pale-popup mfp-with-anim text-center'><p>HELLO !!!</p> <img src='../images/promo/brand1.png' /> </div>"},{title:"demo Title 2",content:"bala bala bala...",html:"<div class='pale-popup mfp-with-anim text-center'><p>HELLO2 !!!</p></div>"},{title:"demo Title 3",content:"bala bala bala...",html:"<div class='pale-popup mfp-with-anim text-center'><p>HELLO3 !!!</p></div>"},{title:"demo Title 4",content:"bala bala bala...",html:"<div class='pale-popup mfp-with-anim text-center'><p>HELLO4 !!!</p></div>"},{title:"demo Title 5",content:"bala bala bala...",html:"<div class='pale-popup mfp-with-anim text-center'><p>HELLO5 !!!</p></div>"},{title:"demo Title 6",content:"bala bala bala...",html:"<div class='pale-popup mfp-with-anim text-center'><p>HELLO6 !!!</p></div>"},{title:"demo Title 7",content:"bala bala bala...",html:"<div class='pale-popup mfp-with-anim text-center'><p>HELLO !!!</p></div>"},{title:"demo Title 8",content:"bala bala bala...",html:"<div class='pale-popup mfp-with-anim text-center'><p>HELLO !!!</p></div>"}],website_url="/",gender="female",canvas,ctx,canvas2,ctx2,oHead,oFringe,oEye,oMouth,faceObject=[oHead,oFringe,oEye,oMouth],oColors,oColorEyebrow,oColorEye,oColorTop,oColorBack,canvas3,ctx3,canvas4,ctx4,canvas5,oBody,oCloth,oBag,oShoes,oBackground,bodyObject=[oBackground,oBody,oCloth,oBag,oShoes],faceCanvasWidth=340,faceCanvasHeight=340,headPosX_onFacebuild=0,headPosY_onFacebuild=10,headScaleW_onFacebuild=1,headScaleH_onFacebuild=1,headPosY_onFacebuild_onIphone4=90,bodyCanvasWidth=340,bodyCanvasHeight=477,headPosX_onBodybuild=130,headPosY_onBodybuild=45,headScaleW_onBodybuild=.26,headScaleH_onBodybuild=.26,bodyPosX_onBodybuild=0,bodyPosY_onBodybuild=0,bodyScaleW_onBodybuild=1,bodyScaleH_onBodybuild=1,timer,loader,userMsg={context:"",text:$("#msg").val(),maxWidth:100,lineHeight:25,x:0,y:50,font:"25pt Calibri",fillStyle:"#333"},assetsItems=[],iSel=0,app={step:0,swiperLayer:$(".elementSwiper"),femaleFaceSwiperLayer:$(".elementSwiper.femaleFace"),maleFaceSwiperLayer:$(".elementSwiper.maleFace"),femaleBodySwiperLayer:$(".elementSwiper.femaleBody"),maleBodySwiperLayer:$(".elementSwiper.maleBody"),gameStart:$(".gameStart"),gameSteps:$(".nextStep,.prevStep"),nextStep:$(".nextStep"),prevStep:$(".prevStep"),faceItem:$(".faceItem"),bodyChoice:$(".bodyChoice"),bodyItem:$(".bodyItem").not(".ok"),bodyItemConfirm:$(".bodyItem").filter(".ok"),bodyItemHasBag:!1,bodyItemCancelBag:$(".elementSwiper").find(".cancelBag"),bodyBagHint:$(".bagHint"),generate:$("#generate"),stepProgram:[{container:$(".startup"),stepFunction:function(){this.container.show().siblings().hide(),app.gameSteps.hide(),$(".btnBegin").on("click",function(){app.step=app.step+1,app.stepProgram[app.step].stepFunction(),$.magnificPopup.close()}),$(".open-popup-link").magnificPopup({type:"inline",midClick:!0,removalDelay:500,callbacks:{beforeOpen:function(){this.st.mainClass=this.st.el.attr("data-effect")}}})}},{container:$(".genderBuild"),stepFunction:function(){this.container.show().siblings().hide();var e=this.container;app.gameSteps.hide(),app.nextStep.show(),e.data("gender")||app.nextStep.addClass("disable"),clearInterval(timer),(new WOW).init(),$genderBtns=$(".genderBox .item"),$genderBtns.on("click",function(){gender=$(this).attr("val"),e.data("gender",gender).data("justSelect",!0),$genderBtns.removeClass("active unselect"),$(this).addClass("active").siblings().addClass("unselect"),app.nextStep.removeClass("disable")})}},{container:$(".faceBuild"),stepFunction:function(){this.container.show().siblings().hide();var e,t=this.container,a=0,i={direction:"vertical",onSlideChangeEnd:function(e,t){a=e.activeIndex}};app.faceItem.fadeIn(2e3),app.prevStep.show(),"female"==gender?(app.femaleFaceSwiperLayer.show(),app.maleFaceSwiperLayer.hide(),e=new Swiper(app.femaleFaceSwiperLayer,i)):(app.maleFaceSwiperLayer.show(),app.femaleFaceSwiperLayer.hide(),e=new Swiper(app.maleFaceSwiperLayer,i)),document.documentElement.clientHeight<500&&(headPosY_onFacebuild=headPosY_onFacebuild_onIphone4);var n=function(){assetsPrepare(gender,function(){t.data("gender",gender)})};t.data("gender")?t.data("gender")==gender||n():n(),app.faceItem.on("click",function(t){t.preventDefault(),$(this).addClass("active").siblings().removeClass("active"),e.slideTo($(this).attr("val"))});for(var o=0;o<faceObject.length;o++)faceObject[o].instance=new Swiper("."+gender+"Face "+faceObject[o].domEle,{onSlideChangeStart:function(e){faceObject[o].iSpr=parseInt(e.activeIndex)},centeredSlides:!1,slidesPerView:5,direction:"horizontal",allowSwipeToPrev:!1,allowSwipeToNext:!1,onTap:function(e,t){faceObject[a].iSpr=parseInt(e.clickedIndex)}})}},{container:$(".bodyBuild"),stepFunction:function(){this.container.show().siblings().hide();var e,t=this.container,a=0,i={direction:"horizontal",onInit:function(e,t){a=app.bodyItem.eq(0).attr("data-draw-squence")}};app.bodyItem.fadeIn(2e3),"female"==gender?(app.femaleBodySwiperLayer.show(),app.maleBodySwiperLayer.hide(),e=new Swiper(app.femaleBodySwiperLayer,i)):(app.maleFaceSwiperLayer.show(),app.femaleFaceSwiperLayer.hide(),e=new Swiper(app.maleBodySwiperLayer,i)),1==app.bodyItemHasBag?($(canvas5).show(),app.bodyBagHint.show()):($(canvas5).hide(),app.bodyBagHint.hide()),app.bodyItem.on("click",function(i){i.preventDefault(),$(this).addClass("active").siblings().removeClass("active"),t.addClass("editMode"),e.slideTo($(this).attr("val")),a=$(this).attr("data-draw-squence")}),app.bodyItemConfirm.on("click",function(e){e.preventDefault(),t.removeClass("editMode")});for(var n=0;n<bodyObject.length;n++){var o="."+gender+"Body "+bodyObject[n].domEle;if($(o).size()>0){var c=$(o).find(".swiper-slide").size();bodyObject[n].instance=new Swiper(o,{onSlideChangeStart:function(e){bodyObject[n].iSpr=parseInt(e.activeIndex)},centeredSlides:!1,slidesPerView:c,direction:"vertical",allowSwipeToPrev:!1,allowSwipeToNext:!1,onTap:function(e,t){bodyObject[a].iSpr=parseInt(e.clickedIndex)}})}}bodyObject[3].instance.on("onTap",function(e){app.bodyItemHasBag=!0,$(canvas5).show()}),app.bodyItemCancelBag.on("click",function(){app.bodyItemHasBag=!1,$(canvas5).hide()}),app.bodyItemConfirm.on("click",function(){1==app.bodyItemHasBag?app.bodyBagHint.show():(app.bodyBagHint.hide(),(new WOW).init())}),app.bodyBagHint.on("click",function(){var e=bagInfo[bodyObject[3].iSpr].html;$.magnificPopup.open({mainClass:"bag-info-popup mfp-3d-unfold",items:{src:"<div>"+e+"</div>"},tError:'<a href="%url%">The content</a> could not be loaded.',type:"inline"})})}},{container:$(".msgBuild"),stepFunction:function(){app.swiperLayer.hide(),this.container.show().siblings().hide(),app.faceItem.hide(),app.bodyItem.hide(),app.generate.show(),app.gameStart.hide()}}]};$(function(){checkPortrait(),$(window).on("resize",checkPortrait),$("#generate button").click(function(){exportResult()}),app.nextStep.on("click",function(){app.step<app.stepProgram.length-1&&0==app.nextStep.hasClass("disable")&&(app.step=app.step+1,app.stepProgram[app.step].stepFunction())}),app.prevStep.on("click",function(){app.step>0&&0==$(this).hasClass("disable")&&(app.step=app.step-1,app.stepProgram[app.step].stepFunction())}),app.stepProgram[app.step].stepFunction()});