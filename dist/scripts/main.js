function sendResultToServer(e){$(".scene .loading").show(),$.post(website_url+"accept_avatar.php",{data:e},function(e){e&&$(".result").fadeOut(1e3,function(){var t='<hr /><div class="container"><h2>Result is:</h2><img src="cache/result'+e+'.jpg" /><button class="button download" onclick="window.open(\'cache/result'+e+'.jpg\');">download result image</button><button class="button" onclick="$(\'.send_email\').toggle();">Send by Email</button><form method="post" action="email.php" class="send_email"><input name="file" value="'+e+'" type="hidden" /><input class="text" name="name" value="" type="text" placeholder="Your Name" /><input class="text" name="email" value="" type="text" placeholder="Your Email" /><input class="button" type="submit" name="submit" /></form></div>';$(this).html(t),$(this).fadeIn(1e3),$(".scene .loading").hide()})})}function Head(e,t,o,a,i,n,s){this.x=e,this.y=t,this.x2=o,this.y2=a,this.w=i,this.h=n,this.image=s,this.iSpr=0}function Fringe(e,t,o,a,i,n,s){this.x=e,this.y=t,this.x2=o,this.y2=a,this.w=i,this.h=n,this.image=s,this.iSpr=0}function Eye(e,t,o,a,i,n,s){this.x=e,this.y=t,this.x2=o,this.y2=a,this.w=i,this.h=n,this.image=s,this.iSpr=0}function Eyebrow(e,t,o,a,i,n,s){this.x=e,this.y=t,this.x2=o,this.y2=a,this.w=i,this.h=n,this.image=s,this.iSpr=0}function Mouth(e,t,o,a,i,n,s){this.x=e,this.y=t,this.x2=o,this.y2=a,this.w=i,this.h=n,this.image=s,this.iSpr=0}function Top(e,t,o,a,i,n,s){this.x=e,this.y=t,this.x2=o,this.y2=a,this.w=i,this.h=n,this.image=s,this.iSpr=0}function Body(e,t,o,a,i,n,s){this.x=e,this.y=t,this.x2=o,this.y2=a,this.w=i,this.h=n,this.image=s,this.iSpr=0}function Cloth(e,t,o,a,i,n,s){this.x=e,this.y=t,this.x2=o,this.y2=a,this.w=i,this.h=n,this.image=s,this.iSpr=0}function Leg(e,t,o,a,i,n,s){this.x=e,this.y=t,this.x2=o,this.y2=a,this.w=i,this.h=n,this.image=s,this.iSpr=0}function Foot(e,t,o,a,i,n,s){this.x=e,this.y=t,this.x2=o,this.y2=a,this.w=i,this.h=n,this.image=s,this.iSpr=0}function Background(e,t,o,a,i,n,s){this.x=e,this.y=t,this.x2=o,this.y2=a,this.w=i,this.h=n,this.image=s,this.iSpr=0}function clear(){ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),ctx2.clearRect(0,0,ctx2.canvas.width,ctx2.canvas.height),ctx3.clearRect(0,0,ctx3.canvas.width,ctx3.canvas.height),ctx4.clearRect(0,0,ctx4.canvas.width,ctx4.canvas.height)}function drawScene(){clear(),ctx.drawImage(oBackground.image,oBackground.x2+oBackground.iSpr*oBackground.w,oBackground.y2,oBackground.w,oBackground.h,oBackground.x,oBackground.y,oBackground.w,oBackground.h),ctx.drawImage(oHead.image,oHead.x2+oHead.iSpr*oHead.w,oHead.y2,oHead.w,oHead.h,oHead.x+headPosX_onFacebuild,oHead.y+headPosY_onFacebuild,oHead.w,oHead.h),ctx.drawImage(oEyebrow.image,oEyebrow.x2+oEyebrow.iSpr*oEyebrow.w,oEyebrow.y2,oEyebrow.w,oEyebrow.h,oEyebrow.x+headPosX_onFacebuild,oEyebrow.y+headPosY_onFacebuild,oEyebrow.w,oEyebrow.h),ctx.drawImage(oEye.image,oEye.x2+oEye.iSpr*oEye.w,oEye.y2,oEye.w,oEye.h,oEye.x+headPosX_onFacebuild,oEye.y+headPosY_onFacebuild,oEye.w,oEye.h),ctx.drawImage(oMouth.image,oMouth.x2+oMouth.iSpr*oMouth.w,oMouth.y2,oMouth.w,oMouth.h,oMouth.x+headPosX_onFacebuild,oMouth.y+headPosY_onFacebuild,oMouth.w,oMouth.h),ctx2.drawImage(oFringe.image,oFringe.x2+oFringe.iSpr*oFringe.w,oFringe.y2,oFringe.w,oFringe.h,oFringe.x+headPosX_onFacebuild,oFringe.y+headPosY_onFacebuild,oFringe.w,oFringe.h),ctx3.drawImage(oBackground.image,oBackground.x2+oBackground.iSpr*oBackground.w,oBackground.y2,oBackground.w,oBackground.h,oBackground.x,oBackground.y,oBackground.w,oBackground.h),ctx3.drawImage(oBody.image,oBody.x2+oBody.iSpr*oBody.w,oBody.y2,oBody.w,oBody.h,oBody.x,oBody.y,oBody.w,oBody.h),ctx3.drawImage(oFoot.image,oFoot.x2+oFoot.iSpr*oFoot.w,oFoot.y2,oFoot.w,oFoot.h,oFoot.x,oFoot.y,oFoot.w,oFoot.h),ctx3.drawImage(oCloth.image,oCloth.x2+oCloth.iSpr*oCloth.w,oCloth.y2,oCloth.w,oCloth.h,oCloth.x,oCloth.y,oCloth.w,oCloth.h),ctx3.drawImage(oHead.image,oHead.x2+oHead.iSpr*oHead.w,oHead.y2,oHead.w,oHead.h,oHead.x+headPosX,oHead.y+headPosY,oHead.w*headScale,oHead.h*headScale),ctx3.drawImage(oEyebrow.image,oEyebrow.x2+oEyebrow.iSpr*oEyebrow.w,oEyebrow.y2,oEyebrow.w,oEyebrow.h,oEyebrow.x+headPosX,oEyebrow.y+headPosY,oEyebrow.w*headScale,oEyebrow.h*headScale),ctx3.drawImage(oEye.image,oEye.x2+oEye.iSpr*oEye.w,oEye.y2,oEye.w,oEye.h,oEye.x+headPosX,oEye.y+headPosY,oEye.w*headScale,oEye.h*headScale),ctx3.drawImage(oFringe.image,oFringe.x2+oFringe.iSpr*oFringe.w,oFringe.y2,oFringe.w,oFringe.h,oFringe.x+headPosX,oFringe.y+headPosY,oFringe.w*headScale,oFringe.h*headScale),ctx3.drawImage(oMouth.image,oMouth.x2+oMouth.iSpr*oMouth.w,oMouth.y2,oMouth.w,oMouth.h,oMouth.x+headPosX,oMouth.y+headPosY,oMouth.w*headScale,oMouth.h*headScale),ctx4.drawImage(canvas3,0,0),userMsg.text=$("#msg").val(),userMsg.context=ctx4,ctx4.font=userMsg.font,ctx4.fillStyle=userMsg.fillStyle,wrapText(userMsg.context,userMsg.text,userMsg.x,userMsg.y,userMsg.maxWidth,userMsg.lineHeight)}function exportResult(){var e,t;t=document.createElement("canvas"),e=t.getContext("2d"),t.width=330,t.height=330;var o=ctx4.getImageData(5,5,330,477);o.data;e.putImageData(o,0,0),zdata2=ctx4.getImageData(5,5,330,477),e.putImageData(zdata2,0,0);var a=t.toDataURL("image/jpeg",1);$("#face_result").attr("src",a),sendResultToServer(a)}function wrapText(e,t,o,a,i,n){for(var s=t.split(""),r="",h=0;h<s.length;h++){var c=r+s[h]+"",p=e.measureText(c),d=p.width;d>i&&h>0?(e.fillText(r,o,a),r=s[h]+"",a+=n):r=c}e.fillText(r,o,a)}function assetsPrepare(e){"number"==typeof timer&&clearInterval(timer),canvas=document.getElementById("scene"),ctx=canvas.getContext("2d"),canvas2=document.getElementById("scene2"),ctx2=canvas2.getContext("2d"),canvas3=document.getElementById("scene3"),ctx3=canvas3.getContext("2d"),canvas4=document.getElementById("scene4"),ctx4=canvas4.getContext("2d");var t=new Image;t.src=website_url+"images/data/"+e+"eyes.png",t.onload=function(){assetsItems.push(this)};var o=new Image;o.src=website_url+"images/data/"+e+"eyebrow.png",o.onload=function(){assetsItems.push(this)};var a=new Image;a.src=website_url+"images/data/"+e+"mouths.png",a.onload=function(){assetsItems.push(this)};var i=new Image;i.src=website_url+"images/data/"+e+"face.png",i.onload=function(){assetsItems.push(this)};var n=new Image;n.src=website_url+"images/data/"+e+"fringes.png",n.onload=function(){assetsItems.push(this)};var s=new Image;s.src=website_url+"images/data/"+e+"body.png",s.onload=function(){assetsItems.push(this)};var r=new Image;r.src=website_url+"images/data/"+e+"cloth.png",r.onload=function(){assetsItems.push(this)};var h=new Image;h.src=website_url+"images/data/"+e+"foot.png",h.onload=function(){assetsItems.push(this)};var c=new Image;c.src=website_url+"images/data/"+e+"background.png",c.onload=function(){assetsItems.push(this)},oHead=new Head(0,0,0,0,340,340,i),oFringe=new Fringe(0,0,0,0,340,340,n),oEye=new Eye(0,0,0,0,340,340,t),oEyebrow=new Eyebrow(0,0,0,0,340,340,o),oMouth=new Mouth(0,0,0,0,340,340,a),oBody=new Body(0,0,0,0,340,477,s),oCloth=new Cloth(0,0,0,0,340,477,r),oFoot=new Foot(0,0,0,0,340,477,h),oBackground=new Background(0,0,0,0,340,340,c),loader=setInterval(checkAssetsLoad,100)}function checkAssetsLoad(){console.log(assetsItems.length),9==assetsItems.length&&(clearInterval(loader),timer=setInterval(drawScene,100),assetsItems=[],$.magnificPopup.close())}function checkPortrait(){document.documentElement.clientHeight>document.documentElement.clientWidth?$("body").removeClass("portraitPls"):$("body").addClass("portraitPls")}var website_url="/",gender="female/",canvas,ctx,canvas2,ctx2,oHead,oFringe,oEyebrow,oEye,oMouth,oTop,oColors,oColorEyebrow,oColorEye,oColorTop,oColorBack,canvas3,ctx3,canvas4,ctx4,oBody,oCloth,oLeg,oFoot,oAccessory,oBackground,headPosX_onFacebuild=0,headPosY_onFacebuild=175,headScale=.3,headPosX=125,headPosY=10,timer,loader,userMsg={context:"",text:$("#msg").val(),maxWidth:100,lineHeight:25,x:0,y:50,font:"25pt Calibri",fillStyle:"#333"},assetsItems=[],iSel=0,app={step:0,swiperLayer:$(".elementSwiper"),gameStart:$(".gameStart"),gameSteps:$(".nextStep,.prevStep"),nextStep:$(".nextStep"),prevStep:$(".prevStep"),faceItem:$(".faceItem"),bodyItem:$(".bodyItem"),generate:$("#generate"),stepProgram:[{container:$(".startup"),stepFunction:function(){app.swiperLayer.hide(),this.container.show().siblings().hide(),app.faceItem.hide(),app.bodyItem.hide(),app.generate.hide(),app.gameSteps.hide(),app.gameStart.show(),$(".btnBegin").on("click",function(){app.step=app.step+1,app.stepProgram[app.step].stepFunction(),$.magnificPopup.close()}),$(".open-popup-link").magnificPopup({type:"inline",midClick:!0,removalDelay:500,callbacks:{beforeOpen:function(){this.st.mainClass=this.st.el.attr("data-effect")}}})}},{container:$(".genderBuild"),stepFunction:function(){app.swiperLayer.hide(),this.container.show().siblings().hide(),app.faceItem.hide(),app.bodyItem.hide(),app.generate.hide(),app.gameSteps.hide(),app.nextStep.show().addClass("disable"),app.gameStart.hide(),clearInterval(timer),(new WOW).init(),$(".genderBox .item").on("click",function(){gender=$(this).attr("val"),$(this).siblings().removeClass("active").end().addClass("active"),app.nextStep.removeClass("disable")})}},{container:$(".faceBuild"),stepFunction:function(){$.magnificPopup.open({items:{src:$('<div class="white-popup" ><p>loading Assets...</p></div>')},type:"inline"}),app.faceItem.show(),app.swiperLayer.show(),this.container.show().siblings().hide(),0==app.faceItem.filter(".active").length?app.faceItem.eq(0).trigger("click"):app.faceItem.filter(".active").trigger("click"),app.generate.hide(),app.prevStep.show(),document.documentElement.clientHeight<500&&(headPosY_onFacebuild=90),assetsPrepare(gender)}},{container:$(".bodyBuild"),stepFunction:function(){app.swiperLayer.show(),this.container.show().siblings().hide(),app.bodyItem.show().eq(0).trigger("click"),app.generate.hide()}},{container:$(".msgBuild"),stepFunction:function(){app.swiperLayer.hide(),this.container.show().siblings().hide(),app.faceItem.hide(),app.bodyItem.hide(),app.generate.show(),app.gameStart.hide()}}]};$(function(){checkPortrait(),$(window).on("resize",checkPortrait);var e=new Swiper(".elementSwiper",{onSlideChangeStart:function(e){console.log(e.activeIndex)}});$(".faceOption a").on("click",function(t){t.preventDefault(),$(this).addClass("active").siblings().removeClass("active"),e.slideTo($(this).attr("val"))}),$(".bodyOption a").on("click",function(t){t.preventDefault(),$(this).addClass("active").siblings().removeClass("active"),e.slideTo($(this).attr("val"))});new Swiper(".headSwiperType",{onSlideChangeStart:function(e){oHead.iSpr=parseInt(e.activeIndex)}}),new Swiper(".fringeSwiperType",{onSlideChangeStart:function(e){oFringe.iSpr=parseInt(e.activeIndex)}}),new Swiper(".eyebrowSwiperType",{onSlideChangeStart:function(e){oEyebrow.iSpr=parseInt(e.activeIndex)}}),new Swiper(".eyeSwiperType",{onSlideChangeStart:function(e){oEye.iSpr=parseInt(e.activeIndex)}}),new Swiper(".mouthSwiperType",{onSlideChangeStart:function(e){oMouth.iSpr=parseInt(e.activeIndex)}}),new Swiper(".backgroundSwiperType",{onSlideChangeStart:function(e){oBackground.iSpr=parseInt(e.activeIndex)}}),new Swiper(".clothSwiperType",{onSlideChangeStart:function(e){oCloth.iSpr=parseInt(e.activeIndex)}}),new Swiper(".footSwiperType",{onSlideChangeStart:function(e){oFoot.iSpr=parseInt(e.activeIndex)}});$("#generate button").click(function(){exportResult()}),app.nextStep.on("click",function(){app.step<app.stepProgram.length-1&&0==app.nextStep.hasClass("disable")&&(app.step=app.step+1,app.stepProgram[app.step].stepFunction())}),app.prevStep.on("click",function(){app.step>0&&0==$(this).hasClass("disable")&&(app.step=app.step-1,app.stepProgram[app.step].stepFunction())}),app.stepProgram[app.step].stepFunction()});