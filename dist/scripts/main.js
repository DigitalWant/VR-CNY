function changeElement(e,t){console.log(e,t)}function sendResultToServer(e){$(".scene .loading").show(),$.post(website_url+"accept_avatar.php",{data:e},function(e){e&&$(".result").fadeOut(1e3,function(){var t='<hr /><div class="container"><h2>Result is:</h2><img src="cache/result'+e+'.jpg" /><button class="button download" onclick="window.open(\'cache/result'+e+'.jpg\');">download result image</button><button class="button" onclick="$(\'.send_email\').toggle();">Send by Email</button><form method="post" action="email.php" class="send_email"><input name="file" value="'+e+'" type="hidden" /><input class="text" name="name" value="" type="text" placeholder="Your Name" /><input class="text" name="email" value="" type="text" placeholder="Your Email" /><input class="button" type="submit" name="submit" /></form></div>';$(this).html(t),$(this).fadeIn(1e3),$(".scene .loading").hide()})})}function Head(e,t,a,i,n,c,s){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=c,this.image=s,this.iSpr=0,this.domEle=".headSwiperType",this.putOn=["ctx1","ctx3"]}function Fringe(e,t,a,i,n,c,s){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=c,this.image=s,this.iSpr=0,this.domEle=".fringeSwiperType",this.putOn=["ctx2","ctx4"]}function Eye(e,t,a,i,n,c,s){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=c,this.image=s,this.iSpr=0,this.domEle=".eyeSwiperType",this.putOn=["ctx1","ctx3"]}function Mouth(e,t,a,i,n,c,s){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=c,this.image=s,this.iSpr=0,this.domEle=".mouthSwiperType",this.putOn=["ctx1","ctx3"]}function Body(e,t,a,i,n,c,s){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=c,this.image=s,this.iSpr=0,this.putOn=["ctx3"]}function Cloth(e,t,a,i,n,c,s){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=c,this.image=s,this.iSpr=0,this.putOn=["ctx3"]}function Leg(e,t,a,i,n,c,s){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=c,this.image=s,this.iSpr=0,this.putOn=["ctx3"]}function Foot(e,t,a,i,n,c,s){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=c,this.image=s,this.iSpr=0,this.putOn=["ctx3"]}function Background(e,t,a,i,n,c,s){this.x=e,this.y=t,this.x2=a,this.y2=i,this.w=n,this.h=c,this.image=s,this.iSpr=0,this.domEle=".backgroundSwiperType",this.putOn=["ctx3"]}function clear(){ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),ctx2.clearRect(0,0,ctx2.canvas.width,ctx2.canvas.height),ctx3.clearRect(0,0,ctx3.canvas.width,ctx3.canvas.height),ctx4.clearRect(0,0,ctx4.canvas.width,ctx4.canvas.height)}function drawScene(){clear();for(var e=0;e<faceObject.length;e++)faceObject[e].putOn.indexOf("ctx1")&&ctx.drawImage(faceObject[e].image,faceObject[e].x2+faceObject[e].iSpr*faceObject[e].w,faceObject[e].y2,faceObject[e].w,faceObject[e].h,faceObject[e].x+headPosX_onFacebuild,faceObject[e].y+headPosY_onFacebuild,faceObject[e].w,faceObject[e].h),faceObject[e].putOn.indexOf("ctx2")&&ctx2.drawImage(faceObject[e].image,faceObject[e].x2+faceObject[e].iSpr*faceObject[e].w,faceObject[e].y2,1*faceObject[e].w,1*faceObject[e].h,faceObject[e].x+headPosX_onFacebuild,faceObject[e].y+headPosY_onFacebuild,faceObject[e].w*headScaleW_onFacebuild,faceObject[e].h*headScaleH_onFacebuild),faceObject[e].putOn.indexOf("ctx3")&&ctx3.drawImage(faceObject[e].image,faceObject[e].x2+faceObject[e].iSpr*faceObject[e].w,faceObject[e].y2,1*faceObject[e].w,1*faceObject[e].h,faceObject[e].x+headPosX_onBodybuild,faceObject[e].y+headPosY_onBodybuild,faceObject[e].w*headScaleW_onBodybuild,faceObject[e].h*headScaleH_onBodybuild);ctx4.drawImage(canvas3,0,0),userMsg.text=$("#msg").val(),userMsg.context=ctx4,ctx4.font=userMsg.font,ctx4.fillStyle=userMsg.fillStyle,wrapText(userMsg.context,userMsg.text,userMsg.x,userMsg.y,userMsg.maxWidth,userMsg.lineHeight)}function exportResult(){var e,t;t=document.createElement("canvas"),e=t.getContext("2d"),t.width=330,t.height=330;var a=ctx4.getImageData(5,5,330,477);a.data;e.putImageData(a,0,0),zdata2=ctx4.getImageData(5,5,330,477),e.putImageData(zdata2,0,0);var i=t.toDataURL("image/jpeg",1);$("#face_result").attr("src",i),sendResultToServer(i)}function wrapText(e,t,a,i,n,c){for(var s=t.split(""),o="",r=0;r<s.length;r++){var p=o+s[r]+"",d=e.measureText(p),h=d.width;h>n&&r>0?(e.fillText(o,a,i),o=s[r]+"",i+=c):o=p}e.fillText(o,a,i)}function assetsPrepare(e,t){"number"==typeof timer&&clearInterval(timer),canvas=document.getElementById("scene"),ctx=canvas.getContext("2d"),canvas2=document.getElementById("scene2"),ctx2=canvas2.getContext("2d"),canvas3=document.getElementById("scene3"),ctx3=canvas3.getContext("2d"),canvas4=document.getElementById("scene4"),ctx4=canvas4.getContext("2d");var a=new Image;a.src=website_url+"images/data/"+e+"/eyes.png",a.onload=function(){};var i=new Image;i.src=website_url+"images/data/"+e+"/mouths.png",i.onload=function(){};var n=new Image;n.src=website_url+"images/data/"+e+"/face.png",n.onload=function(){};var c=new Image;c.src=website_url+"images/data/"+e+"/fringes.png",c.onload=function(){};var s=new Image;s.src=website_url+"images/data/"+e+"/background.png",s.onload=function(){},faceObject[0]=new Head(0,0,0,0,340,340,n),faceObject[1]=new Fringe(0,0,0,0,340,340,c),faceObject[2]=new Eye(0,0,0,0,340,340,a),faceObject[3]=new Mouth(0,0,0,0,340,340,i),bodyObject[0]=new Background(0,0,0,0,340,340,s),timer=setInterval(drawScene,1e3)}function checkPortrait(){document.documentElement.clientHeight>document.documentElement.clientWidth?$("body").removeClass("portraitPls"):$("body").addClass("portraitPls")}var website_url="/",gender="female",canvas,ctx,canvas2,ctx2,oHead,oFringe,oEye,oMouth,faceObject=[oHead,oFringe,oEye,oMouth],oColors,oColorEyebrow,oColorEye,oColorTop,oColorBack,canvas3,ctx3,canvas4,ctx4,oBody,oCloth,oLeg,oFoot,oAccessory,oBackground,bodyObject=[oBackground,oBody,oCloth,oLeg,oFoot,oAccessory],headPosX_onFacebuild=0,headPosY_onFacebuild=10,headScaleW_onFacebuild=1,headScaleH_onFacebuild=1,headPosY_onFacebuild_onIphone4=90,headPosX_onBodybuild=0,headPosY_onBodybuild=10,headScaleW_onBodybuild=1,headScaleH_onBodybuild=1,headScale=.3,headPosX=125,headPosY=10,timer,loader,userMsg={context:"",text:$("#msg").val(),maxWidth:100,lineHeight:25,x:0,y:50,font:"25pt Calibri",fillStyle:"#333"},assetsItems=[],iSel=0,app={step:0,swiperLayer:$(".elementSwiper"),femaleFaceSwiperLayer:$(".elementSwiper.femaleFace"),maleFaceSwiperLayer:$(".elementSwiper.maleFace"),femaleBodySwiperLayer:$(".elementSwiper.femaleBody"),maleBodySwiperLayer:$(".elementSwiper.maleBody"),gameStart:$(".gameStart"),gameSteps:$(".nextStep,.prevStep"),nextStep:$(".nextStep"),prevStep:$(".prevStep"),faceItem:$(".faceItem"),bodyItem:$(".bodyItem"),generate:$("#generate"),stepProgram:[{container:$(".startup"),stepFunction:function(){this.container.show().siblings().hide(),app.gameSteps.hide(),$(".btnBegin").on("click",function(){app.step=app.step+1,app.stepProgram[app.step].stepFunction(),$.magnificPopup.close()}),$(".open-popup-link").magnificPopup({type:"inline",midClick:!0,removalDelay:500,callbacks:{beforeOpen:function(){this.st.mainClass=this.st.el.attr("data-effect")}}})}},{container:$(".genderBuild"),stepFunction:function(){this.container.show().siblings().hide();var e=this.container;app.gameSteps.hide(),app.nextStep.show(),e.data("gender")||app.nextStep.addClass("disable"),clearInterval(timer),(new WOW).init(),$genderBtns=$(".genderBox .item"),$genderBtns.on("click",function(){gender=$(this).attr("val"),e.data("gender",gender).data("justSelect",!0),$genderBtns.removeClass("active unselect"),$(this).addClass("active").siblings().addClass("unselect"),app.nextStep.removeClass("disable")})}},{container:$(".faceBuild"),stepFunction:function(){this.container.show().siblings().hide();var e,t=this.container,a=0,i={onSlideChangeEnd:function(e,t){a=e.activeIndex}};app.faceItem.fadeIn(2e3),app.prevStep.show(),"female"==gender?(app.femaleFaceSwiperLayer.show(),app.maleFaceSwiperLayer.hide(),e=new Swiper(app.femaleFaceSwiperLayer,i)):(app.maleFaceSwiperLayer.show(),app.femaleFaceSwiperLayer.hide(),e=new Swiper(app.maleFaceSwiperLayer,i)),document.documentElement.clientHeight<500&&(headPosY_onFacebuild=headPosY_onFacebuild_onIphone4);var n=function(){assetsPrepare(gender,function(){t.data("gender",gender)})};t.data("gender")?t.data("gender")==gender||n():n(),app.faceItem.on("click",function(t){t.preventDefault(),$(this).addClass("active").siblings().removeClass("active"),e.slideTo($(this).attr("val"))});for(var c=0;c<faceObject.length;c++)faceObject[c].instance=new Swiper("."+gender+"Face "+faceObject[c].domEle,{onSlideChangeStart:function(e){faceObject[c].iSpr=parseInt(e.activeIndex)},centeredSlides:!1,slidesPerView:5,direction:"horizontal",allowSwipeToPrev:!1,allowSwipeToNext:!1,onTap:function(e,t){faceObject[a].iSpr=parseInt(e.clickedIndex)}})}},{container:$(".bodyBuild"),stepFunction:function(){this.container.show().siblings().hide();this.container;app.bodyItem.fadeIn(2e3)}},{container:$(".msgBuild"),stepFunction:function(){app.swiperLayer.hide(),this.container.show().siblings().hide(),app.faceItem.hide(),app.bodyItem.hide(),app.generate.show(),app.gameStart.hide()}}]};$(function(){checkPortrait(),$(window).on("resize",checkPortrait),$("#generate button").click(function(){exportResult()}),app.nextStep.on("click",function(){app.step<app.stepProgram.length-1&&0==app.nextStep.hasClass("disable")&&(app.step=app.step+1,app.stepProgram[app.step].stepFunction())}),app.prevStep.on("click",function(){app.step>0&&0==$(this).hasClass("disable")&&(app.step=app.step-1,app.stepProgram[app.step].stepFunction())}),app.stepProgram[app.step].stepFunction()});